<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Glenn Williams">
<meta name="dcterms.date" content="2023-03-22">

<title>Tidying and Merging Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="exercises_files/libs/clipboard/clipboard.min.js"></script>
<script src="exercises_files/libs/quarto-html/quarto.js"></script>
<script src="exercises_files/libs/quarto-html/popper.min.js"></script>
<script src="exercises_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exercises_files/libs/quarto-html/anchor.min.js"></script>
<link href="exercises_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exercises_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exercises_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exercises_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exercises_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tidying and Merging Data</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      Glenn Williams 
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Northumbria University
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 22, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">March 22, 2023</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="abstract-title">Abstract</div>
      Working with multiple data sets
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#instructions" id="toc-instructions" class="nav-link active" data-scroll-target="#instructions">Instructions</a></li>
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">Basics</a>
  <ul class="collapse">
  <li><a href="#exercise-1.-loading-the-data" id="toc-exercise-1.-loading-the-data" class="nav-link" data-scroll-target="#exercise-1.-loading-the-data">Exercise 1. Loading the data</a></li>
  <li><a href="#exercise-2.-investigating-the-data" id="toc-exercise-2.-investigating-the-data" class="nav-link" data-scroll-target="#exercise-2.-investigating-the-data">Exercise 2. Investigating the data</a></li>
  <li><a href="#exercise-3.-renaming-columns" id="toc-exercise-3.-renaming-columns" class="nav-link" data-scroll-target="#exercise-3.-renaming-columns">Exercise 3. Renaming columns</a></li>
  <li><a href="#exercise-4.-combine-the-data-sets-1" id="toc-exercise-4.-combine-the-data-sets-1" class="nav-link" data-scroll-target="#exercise-4.-combine-the-data-sets-1">Exercise 4. Combine the Data Sets 1</a>
  <ul class="collapse">
  <li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a">A</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b">B</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c">C</a></li>
  </ul></li>
  <li><a href="#exercise-5.-combine-the-data-sets-2" id="toc-exercise-5.-combine-the-data-sets-2" class="nav-link" data-scroll-target="#exercise-5.-combine-the-data-sets-2">Exercise 5. Combine the Data Sets 2</a></li>
  <li><a href="#exercise-5.-combine-the-data-sets-2-1" id="toc-exercise-5.-combine-the-data-sets-2-1" class="nav-link" data-scroll-target="#exercise-5.-combine-the-data-sets-2-1">Exercise 5. Combine the Data Sets 2</a></li>
  <li><a href="#exercise-6.-combine-the-data-sets-3" id="toc-exercise-6.-combine-the-data-sets-3" class="nav-link" data-scroll-target="#exercise-6.-combine-the-data-sets-3">Exercise 6. Combine the Data Sets 3</a></li>
  <li><a href="#exercise-7.-filter-data-1" id="toc-exercise-7.-filter-data-1" class="nav-link" data-scroll-target="#exercise-7.-filter-data-1">Exercise 7. Filter Data 1</a></li>
  <li><a href="#exercise-8.-filter-data-2" id="toc-exercise-8.-filter-data-2" class="nav-link" data-scroll-target="#exercise-8.-filter-data-2">Exercise 8. Filter Data 2</a></li>
  </ul></li>
  <li><a href="#advanced" id="toc-advanced" class="nav-link" data-scroll-target="#advanced">Advanced</a>
  <ul class="collapse">
  <li><a href="#exercise-9.-combining-and-fixing-the-data-sets" id="toc-exercise-9.-combining-and-fixing-the-data-sets" class="nav-link" data-scroll-target="#exercise-9.-combining-and-fixing-the-data-sets">Exercise 9. Combining and Fixing the Data Sets</a></li>
  <li><a href="#exercise-10.-plotting-the-data" id="toc-exercise-10.-plotting-the-data" class="nav-link" data-scroll-target="#exercise-10.-plotting-the-data">Exercise 10. Plotting the Data</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="instructions" class="level1">
<h1>Instructions</h1>
<p>Complete the following exercises. These require you to use two data sets from the <code>data</code> folder. They are the full data sets associated with the simplified versions given in the chapter/presentation.</p>
<p>The basics will get you used to using individual data transformation functions. The advanced exercises will focus more on chaining together multiple functions to clean a real(ish) data set and make plots of the results using some new function options you haven’t used yet.</p>
</section>
<section id="basics" class="level1">
<h1>Basics</h1>
<p>First off, load the libraries you’ll need for the exercises. As always, load the <code>tidyverse</code> library for working with data and the <code>here</code> library for working with file paths. We will also use the <code>janitor</code> library for cleaning column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1.-loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1.-loading-the-data">Exercise 1. Loading the data</h2>
<ol type="1">
<li>Load the data from the <code>height-weights</code> sub-folder from within the <code>data</code> folder. Assign this to the object <code>exp_dat</code>.</li>
<li>Load the data from the file <code>height-weights_demographics.csv</code> from within the <code>data</code> folder. Assign this to the object <code>demo_dat</code>.</li>
</ol>
<div class="cell">

</div>
</section>
<section id="exercise-2.-investigating-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2.-investigating-the-data">Exercise 2. Investigating the data</h2>
<p>Print the names of the data sets or use <code>glimpse()</code> in a code chunk for each data set to get an idea of what the data set looks like.</p>
<div class="cell">

</div>
<div class="cell">

</div>
</section>
<section id="exercise-3.-renaming-columns" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3.-renaming-columns">Exercise 3. Renaming columns</h2>
<p>Use the <code>clean_names()</code> function from the <code>janitor</code> package to make consistent column names. Assign the result of this to <code>dat2</code>.</p>
<div class="cell">

</div>
</section>
<section id="exercise-4.-combine-the-data-sets-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4.-combine-the-data-sets-1">Exercise 4. Combine the Data Sets 1</h2>
<section id="a" class="level3">
<h3 class="anchored" data-anchor-id="a">A</h3>
<p>Join the experimental and demographic data, keeping rows from each data set. Print this out without saving the result to a new object. Use the column <code>subject</code> as an identifier/key between the data sets.</p>
<div class="cell">

</div>
</section>
<section id="b" class="level3">
<h3 class="anchored" data-anchor-id="b">B</h3>
<p>What does the warning say? Why do you think this happened?</p>
<p><strong>Answer:</strong></p>
</section>
<section id="c" class="level3">
<h3 class="anchored" data-anchor-id="c">C</h3>
<p>Fix any issues that lead to the warning. Overwrite the offending data set with your changes so this doesn’t happen again.</p>
<div class="cell">

</div>
</section>
</section>
<section id="exercise-5.-combine-the-data-sets-2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5.-combine-the-data-sets-2">Exercise 5. Combine the Data Sets 2</h2>
<p>Combine the data sets, keeping only rows in the demographic data that have the same subjects in the experimental data.</p>
<div class="cell">

</div>
</section>
<section id="exercise-5.-combine-the-data-sets-2-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5.-combine-the-data-sets-2-1">Exercise 5. Combine the Data Sets 2</h2>
<p>Combine the data sets, keeping only rows in the experimental data that have a the same subjects in the demographics data. There are two ways to do this. Try both.</p>
<div class="cell">

</div>
<div class="cell">

</div>
</section>
<section id="exercise-6.-combine-the-data-sets-3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6.-combine-the-data-sets-3">Exercise 6. Combine the Data Sets 3</h2>
<p>Join the data sets keeping only rows that have the same subjects in both data sets.</p>
<div class="cell">

</div>
</section>
<section id="exercise-7.-filter-data-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-7.-filter-data-1">Exercise 7. Filter Data 1</h2>
<p>Filter the experimental data to only rows with participants for which you have demographic data. Only keep the columns from the experimental data.</p>
<div class="cell">

</div>
</section>
<section id="exercise-8.-filter-data-2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8.-filter-data-2">Exercise 8. Filter Data 2</h2>
<p>Filter the experimental data to only rows for which you have no participant IDs in the demographic data. Only keep the columns from the experimental data.</p>
<div class="cell">

</div>
</section>
</section>
<section id="advanced" class="level1">
<h1>Advanced</h1>
<section id="exercise-9.-combining-and-fixing-the-data-sets" class="level2">
<h2 class="anchored" data-anchor-id="exercise-9.-combining-and-fixing-the-data-sets">Exercise 9. Combining and Fixing the Data Sets</h2>
<ul>
<li><p>Combine the experimental and demographic data sets such that you only include rows for participants that are in the experimental data.</p></li>
<li><p>Fix any other problems you notice in the data set. This can involve filtering out impossible values or reshaping the data in any way you see fit (note, NAs are fine to keep).</p></li>
<li><p>Assign the result of this to <code>dat</code>.</p></li>
</ul>
<div class="cell">

</div>
</section>
<section id="exercise-10.-plotting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-10.-plotting-the-data">Exercise 10. Plotting the Data</h2>
<p>Simulate a data set of 40 participants within a tibble. Create columns for <code>age</code> made from sampled values between 18:80 and for IQ sampled randomly from a normal distribution with a mean 150 and a standard deviation of 15. Name this tibble <code>new_dat</code>.</p>
<div class="cell">

</div>
<p>Combine <code>dat</code> and <code>new_dat</code>. Create a new column called <code>age_bracket</code> which has the label “&lt; 40” for those under 40 years of age and “&gt; 40” for those over 40 years of age. Assign this to the object <code>merged_dat</code>.</p>
<div class="cell">

</div>
<p>Taking <code>merged_dat</code> remove any missing values from the <code>age</code> and <code>iq</code> columns. <strong>Pipe the result into</strong> <code>ggplot()</code>. Create a scatter plot of <code>age</code> against <code>iq</code>. Add a smooth to the plot using the <code>loess</code> method predicting <code>y</code> values from <code>x</code> values. Remove the ribbon for standard error on the smooth.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>?geom_smooth()</code> to see options on which arguments are expected and which options can be specified.</p>
</div>
</div>
<div class="cell">

</div>
<p>Taking <code>merged_dat</code> group the data by the age bracket column and make a summary of the mean ages and counts for each age bracket. <strong>Pipe the result into</strong> <code>ggplot()</code> and create a bar plot of the counts.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you get an error ensure that you use the correct <code>stat</code> in your bar plot.</p>
</div>
</div>
<div class="cell">

</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>